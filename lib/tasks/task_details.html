<link rel="import" href="../../../packages/polymer/polymer.html">

<link rel="import" href="../../../packages/core_elements/core_selector.html">
<link rel="import" href="../../../packages/core_elements/core_item.html">
<link rel="import" href="../../../packages/paper_elements/paper_item.html">
<link rel="import" href="../../../packages/paper_elements/paper_radio_button.html">
<link rel="import" href="../../../packages/paper_elements/paper_radio_group.html"> 

<link rel="import" href="../common/components/grade_input.html">
<link rel="import" href="../common/components/grade_item.html">
<link rel="import" href="../common/components/grade_fascia.html">
<link rel="import" href="../common/components/endpoint_dropdown_menu.html">
<link rel="import" href="../common/components/grade_dropdown_menu.html">
<link rel="import" href="../common/components/loading_panel.html">
<link rel="import" href="../common/components/grade_button.html">

<link rel="import" href="tasks.html">

<polymer-element name="task-details" layout vertical> 
  <template>
    <style>
			  
			  grade-input::shadow [height] {
			     max-height: 150px;
			  }
			  
			  :host [radios] {
			   height:65px; 
			   position: relative; 
			   top:-8px
			  }
			  
			  :host paper-radio-group {
  			  border-bottom: 1px solid lightgrey;
			  }
			  
			  :host paper-radio-button[disabled] /deep/ #onRadio" : {
          opacity:100%;
          background-color: blue
         }
         
         :host [multifield] {
         
              position:relative; 
              left:-10px; 
              top:-5px; 
              padding-top:10px;
              padding-left:10px;
         }
         
         :host [graphs] {
         
           min-height:80px; 
           margin-top:15px
         
         }
			  
			  
		      :host [dropitem] {
		          max-height:25px;
		          padding:10px
		       }
			  
    </style>
 
	    <div hidden?="{{item==null}}" style="overflow-y: auto">
			  
			  <div radios layout vertical center border>
				  <paper-radio-group fascia-title selected="{{ item.bean[operation_key] }}">
	          <paper-radio-button name="{{publish_operation}}" label="PUBLISH" disabled="{{!editable}}"></paper-radio-button>
	          <paper-radio-button name="{{add_operation}}" label="ADD" disabled="{{!editable}}"></paper-radio-button>
	          <paper-radio-button name="{{remove_operation}}" label="REMOVE" disabled="{{!editable}}"></paper-radio-button>
	         </paper-radio-group>
        </div>     
	     
	      <!-- name -->
	      <grade-item icon=chevron-right>
	        <grade-fascia truncate>
	          <grade-input  fascia-title 
	                        disabled="{{!editable}}" 
	                        label="{{ name_key | suffix}}" 
	                        value="{{item.bean[name_key] | trim }}">
	          </grade-input>
	          <div fascia-subtitle>
	            <span>{{ name_key | start}}</span><span fg bolder>{{ name_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	      
	      <!-- label -->
	      <grade-item icon=chevron-right>
	        <grade-fascia truncate>
	          <grade-input  fascia-title 
	                        disabled="{{!editable}}" 
	                        label="{{ label_key | suffix}}" 
	                        value="{{item.bean[label_key] | trim}}">
	          </grade-input>
	          <div fascia-subtitle>
	            <span>{{ label_key | start}}</span><span fg bolder>{{ label_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	      
	        <!-- source endpoint -->
	        
	        <!--  required?="true"
                   invalid="{{ item.fieldsInvalidity[source_endpoint_key] }}" -->
                   
         <div flex framing rounded multifield>
         
	          <grade-item icon=chevron-right>
			     
			        <div layout vertical flex>
			        
				        <grade-fascia>
				        
				          <grade-dropdown-menu fascia-title flex
		                  
		                   disabled="{{ !editable }}" 
		                   selected="{{ item.bean[source_endpoint_key] }}"
		                   label="{{ source_endpoint_key | suffix }} ?" 
		                   valueattr="itemId">
		                   
			                <template repeat="{{areaEndpoints in gradeEndpoints.areaEndpoints}}">
			                  <template repeat="{{item in areaEndpoints.endpointsStorage.synchedData}}">
			                    <paper-item dropitem smaller label="{{item.model.name | uppercase}}" itemId="{{item.model.id}}"></paper-item>
			                  </template>
			                </template>
			                
		              </grade-dropdown-menu>
		              
				          <div fascia-subtitle truncate>
				            <span>{{ source_endpoint_key | start}}</span><span fg bolder>{{ source_endpoint_key | suffix}}</span>
				          </div>
				          
				        </grade-fascia>   
				      
				       <!-- source graphs -->
			          <grade-fascia truncate>
			             
			             <div graphs horizontal layout flex fascia-title>
				            
				             <div smaller wired rounded relative flex>
			                    <loading-panel fit loading="{{sourceEnpoint.loadingGraphs==true}}" message="loading the graphs" style="overflow-y:auto;">
			                       <core-selector notap?="{{!editable}}" id="sourceGraphsSelector" selected="{{item.bean[source_graph_key]}}" multi valueattr="item" selectedAttribute="bg-selected">
						                   <template repeat="{{graph in sourceEnpoint.model.graphs}}">
						                      <div style="padding-left:5px" item={{graph}}><span>{{ graph | start}}</span><span fg>{{ graph | suffix}}</span></div>
						                   </template>
						                </core-selector>
			                    </loading-panel>
			                 </div>
			                 
		                  <grade-button icon="refresh" label="refresh graphs" on-click="{{refreshSourceEnpointGraphs}}" style="padding-left:5px;padding-right:5px;"></grade-button>
		           
		              </div>
				                           
			            <div fascia-subtitle>
			              <span>{{ source_graph_key | start}}</span><span fg bolder>{{ source_graph_key | suffix}}</span>
			            </div>
			          </grade-fascia>   
		          
		          </div>
		     </grade-item>

      </div>      
	     
	    <div flex framing rounded multifield> 
	      
	      <grade-item icon=chevron-right>
	      
	        <div layout vertical flex>
	        
				          <grade-fascia>
			    
			              <!-- target endpoint -->
                    <grade-dropdown-menu fascia-title flex
			                   disabled="{{ !editable }}" 
			                   selected="{{ item.bean[target_endpoint_key] }}"
			                   label="{{ target_endpoint_key | suffix }} ?" 
			                   valueattr="itemId">
			                   
			                <template repeat="{{areaEndpoints in gradeEndpoints.areaEndpoints}}">
			                  <template repeat="{{item in areaEndpoints.endpointsStorage.synchedData}}">
			                    <paper-item dropitem smaller label="{{item.model.name | uppercase}}" itemId="{{item.model.id}}"></paper-item>
			                  </template>
			                </template>
			              
			              </grade-dropdown-menu>
			              
			              <div fascia-subtitle truncate>
			                <span>{{ target_endpoint_key | start}}</span><span fg bolder>{{ target_endpoint_key | suffix}}</span>
			              </div>
			            
			            </grade-fascia>   
				        
				         <!-- target graph -->
			           <grade-fascia truncat>
			           
			                <div graphs horizontal layout flex fascia-title>
                    
		                     <div smaller wired rounded relative flex>
		                          <loading-panel fit loading="{{targetEnpoint.loadingGraphs==true}}" message="loading the graphs" style="overflow-y:auto;">
		                             <core-selector notap?="{{!editable}}" id="targetGraphsSelector" selected="{{item.bean[target_graph_key]}}" valueattr="item" selectedAttribute="bg-selected">
		                               <template repeat="{{graph in targetEnpoint.model.graphs}}">
		                                  <div style="padding-left:5px" item={{graph}}><span>{{ graph | start}}</span><span fg>{{ graph | suffix}}</span></div>
		                               </template>
		                            </core-selector>
		                          </loading-panel>
		                       </div>
		                       
		                      <grade-button icon="refresh" label="refresh graphs" on-click="{{refreshSourceEnpointGraphs}}" style="padding-left:5px;padding-right:5px;"></grade-button>
		               
		                  </div>
			                
			              <div fascia-subtitle>
			                <span>{{ target_graph_key | start}}</span><span fg bolder>{{ target_graph_key | suffix}}</span>
			              </div>
			              
			            </grade-fascia> 
	           </div>
	         </grade-item>
	      </div>
	      
	      <!-- transform query -->
	      <grade-item icon=chevron-right>
	        <grade-fascia>
	           <div smaller wired rounded truncate inset fascia-title >
		          <grade-input 
		                        disabled="{{!editable}}" 
		                        maxRows="5"
		                        multiline
		                        label="{{ transform_query_key | suffix}}" 
		                        value="{{item.bean[transform_query_key] | trim }}">
		          </grade-input>
	          </div>
	          <div fascia-subtitle>
	            <span>{{ transform_query_key | start}}</span><span fg bolder>{{ transform_query_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	      
	             
        <!-- difference query -->
        <grade-item icon=chevron-right hidden?="{{ item.bean[operation_key] == publish_operation}}">
          <grade-fascia>
             <div smaller wired rounded truncate inset fascia-title >
              <grade-input 
                            disabled="{{!editable}}" 
                            maxRows="5"
                            multiline
                            label="{{ difference_query_key | suffix}}" 
                            value="{{item.bean[difference_query_key] | trim }}">
              </grade-input>
            </div>
            <div fascia-subtitle>
              <span>{{ difference_query_key | start}}</span><span fg bolder>{{ difference_query_key | suffix}}</span>
            </div>
          </grade-fascia>   
        </grade-item>
	      
	      <!-- note -->
	      <grade-item icon=chevron-right>
	        <grade-fascia truncate>
	          <grade-input  fascia-title 
	                        disabled="{{!editable}}" 
	                        maxRows="5"
	                        multiline
	                        label="{{ note_key | suffix}}" 
	                        value="{{item.bean[note_key] | trim}}">
	          </grade-input>
	          <div fascia-subtitle>
	            <span>{{ note_key | start}}</span><span fg bolder>{{ note_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	    </div> 
    </template>
		
</polymer-element>
