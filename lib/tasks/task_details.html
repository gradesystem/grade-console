<link rel="import" href="../../../packages/polymer/polymer.html">

<link rel="import" href="../../../packages/core_elements/core_selector.html">
<link rel="import" href="../../../packages/paper_elements/paper_item.html">

<link rel="import" href="../common/components/grade_input.html">
<link rel="import" href="../common/components/grade_item.html">
<link rel="import" href="../common/components/grade_fascia.html">
<link rel="import" href="../common/components/endpoint_dropdown_menu.html">
<link rel="import" href="../common/components/grade_dropdown_menu.html">
<link rel="import" href="../common/components/loading_panel.html">
<link rel="import" href="../common/components/grade_button.html">

<link rel="import" href="tasks.html">

<polymer-element name="task-details" layout vertical> 
  <template>
    <style>
			  
			  grade-input::shadow [height] {
			     max-height: 150px;
			  }
			  
    </style>
 
    <template if="{{item!=null}}">
	    <div style="overflow-y: auto;">
			  
	      <!-- name -->
	      <grade-item icon=chevron-right>
	        <grade-fascia truncate>
	          <grade-input  fascia-title 
	                        disabled="{{!editable}}" 
	                        label="{{ name_key | suffix}}" 
	                        value="{{item.bean[name_key] | trim | uppercase}}">
	          </grade-input>
	          <div fascia-subtitle>
	            <span>{{ name_key | start}}</span><span fg bolder>{{ name_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	      
	      <!-- label -->
	      <grade-item icon=chevron-right>
	        <grade-fascia truncate>
	          <grade-input  fascia-title 
	                        disabled="{{!editable}}" 
	                        label="{{ label_key | suffix}}" 
	                        value="{{item.bean[label_key] | trim | uppercase}}">
	          </grade-input>
	          <div fascia-subtitle>
	            <span>{{ label_key | start}}</span><span fg bolder>{{ label_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	      
	      <!-- operation -->
	      <grade-item icon=chevron-right>
	        <grade-fascia>
	          <grade-dropdown-menu fascia-title 
	                 disabled="{{ !editable }}" 
	                 selected="{{ item.bean[operation_key] }}"
	                 label="{{ operation_key | suffix }} ?" 
	                 valueattr="itemId"
	                 >
		                 <template repeat="{{operation in operations}}">
							        <paper-item label="{{operation.label}}" itemId="{{operation.value}}"></paper-item>
							      </template>
	                 </grade-dropdown-menu>
	          <div fascia-subtitle truncate>
	            <span>{{ operation_key | start}}</span><span fg bolder>{{ operation_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	      
	      <!-- SOURCE -->
	      <fieldset horizontal layout wired rounded>
	        <legend>Source</legend>
	      
	        <!-- source endpoint -->
	        
	        <!--  required?="true"
                   invalid="{{ item.fieldsInvalidity[source_endpoint_key] }}" -->
		        <grade-fascia>
		          <grade-dropdown-menu fascia-title flex
                   disabled="{{ !editable }}" 
                   selected="{{ item.bean[source_endpoint_key] }}"
                   label="{{ source_endpoint_key | suffix }} ?" 
                   valueattr="itemId"
                   >
                <template repeat="{{areaEndpoints in gradeEndpoints.areaEndpoints}}">
                  <template repeat="{{item in areaEndpoints.endpointsStorage.synchedData}}">
                    <paper-item label="{{item.model.name}}" itemId="{{item.model.uri}}"></paper-item>
                  </template>
                </template>
              </grade-dropdown-menu>
		          <div fascia-subtitle truncate>
		            <span>{{ source_endpoint_key | start}}</span><span fg bolder>{{ source_endpoint_key | suffix}}</span>
		          </div>
		        </grade-fascia>   
		      
		       <!-- source graphs -->
	          <grade-fascia truncate>
	             <div horizontal layout flex fascia-title>
		             <div style="min-height:250px;" relative flex>
	                    <loading-panel fit loading="{{sourceEnpoint.loadingGraphs}}" message="loading the graphs" style="overflow-y:auto;">
	                       <core-selector id="sourceGraphsSelector" selected="{{item.bean[source_graph_key]}}" multi valueattr="item" selectedAttribute="bg-selected" fascia-title>
				                   <template repeat="{{graph in sourceEnpoint.model.graphs}}">
				                      <paper-item label="{{graph}}" item={{graph}}></paper-item>
				                    </template>
				                </core-selector>
	                    </loading-panel>
	                 </div>
                  <grade-button icon="refresh" label="refresh graphs" on-click="{{refreshSourceEnpointGraphs}}" style="padding-left:5px;padding-right:5px;"></grade-button>
           
              </div>
		            
		                 
	            <div fascia-subtitle>
	              <span>{{ source_graph_key | start}}</span><span fg bolder>{{ source_graph_key | suffix}}</span>
	            </div>
	          </grade-fascia>   
	
	      </fieldset>
	      
	      <!-- TARGET -->
	      <fieldset horizontal layout wired rounded>
	        <legend>Target</legend>
	      
	        <!-- target endpoint -->
            <grade-fascia>
              <grade-dropdown-menu fascia-title flex
                   disabled="{{ !editable }}" 
                   selected="{{ item.bean[target_endpoint_key] }}"
                   label="{{ target_endpoint_key | suffix }} ?" 
                   valueattr="itemId"
                   >
                <template repeat="{{areaEndpoints in gradeEndpoints.areaEndpoints}}">
                  <template repeat="{{item in areaEndpoints.endpointsStorage.synchedData}}">
                    <paper-item label="{{item.model.name}}" itemId="{{item.model.uri}}"></paper-item>
                  </template>
                </template>
              </grade-dropdown-menu>
              <div fascia-subtitle truncate>
                <span>{{ target_endpoint_key | start}}</span><span fg bolder>{{ target_endpoint_key | suffix}}</span>
              </div>
            </grade-fascia>   
	        
	         <!-- target graphs -->
              <grade-fascia>
               <div horizontal layout flex fascia-title>
	              <grade-dropdown-menu flex
	                   disabled="{{ !editable }}" 
	                   selected="{{ item.bean[target_graph_key] }}"
	                   label="{{ target_graph_key | suffix }} ?" 
	                   valueattr="itemId"
	                   >
	                   <template repeat="{{graph in targetEnpoint.model.graphs}}">
                        <paper-item label={{graph}} itemId={{graph}}></paper-item>
	                   </template>
	              </grade-dropdown-menu>
	              <grade-button icon="refresh" label="refresh graphs" on-click="{{refreshTargetEnpointGraphs}}" style="padding-left:5px;padding-right:5px;"></grade-button>
           
              </div>
                
              <div fascia-subtitle>
                <span>{{ target_graph_key | start}}</span><span fg bolder>{{ target_graph_key | suffix}}</span>
              </div>
            </grade-fascia> 
	      
	      </fieldset>
	      
	      <!-- query -->
	      <grade-item icon=chevron-right>
	        <grade-fascia truncate>
	          <grade-input  fascia-title 
	                        disabled="{{!editable}}" 
	                        maxRows="5"
	                        multiline
	                        label="{{ query_key | suffix}}" 
	                        value="{{item.bean[query_key] | trim | uppercase}}">
	          </grade-input>
	          <div fascia-subtitle>
	            <span>{{ query_key | start}}</span><span fg bolder>{{ query_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	      
	      <!-- note -->
	      <grade-item icon=chevron-right>
	        <grade-fascia truncate>
	          <grade-input  fascia-title 
	                        disabled="{{!editable}}" 
	                        maxRows="5"
	                        multiline
	                        label="{{ note_key | suffix}}" 
	                        value="{{item.bean[note_key] | trim | uppercase}}">
	          </grade-input>
	          <div fascia-subtitle>
	            <span>{{ note_key | start}}</span><span fg bolder>{{ note_key | suffix}}</span>
	          </div>
	        </grade-fascia>   
	      </grade-item>
	    </div> 
    </template>
		
  </template> 
</polymer-element>
