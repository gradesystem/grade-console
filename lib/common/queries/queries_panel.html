<link rel="import" href="../../../../packages/polymer/polymer.html">

<link rel="import" href="../../../../packages/core_elements/core_pages.html">
<link rel="import" href="../../../../packages/core_elements/core_animated_pages.html">

<link rel="import" href="../components/grade_scaffold.html">
<link rel="import" href="../components/page_menu.html">
<link rel="import" href="../components/grade_header_panel.html">
<link rel="import" href="../components/grade_input.html">
<link rel="import" href="../components/grade_button.html">
<link rel="import" href="../components/grade_dialog.html">

<link rel="import" href="query_list.html">
<link rel="import" href="query_details.html">

<link rel="import" href="query_playground.html">

<polymer-element name="queries-panel" horizontal layout>

  <template>
  
  <core-animated-pages flex selected="{{area}}">

	  <grade-scaffold flex>
	  
	      <grade-header-panel main fit paneltitle="QUERIES">
	      
	        <page-menu menu></page-menu>
	
	            <grade-input toolbar
	                        smaller 
	                        style="width:120px; margin-right:10px" 
	                        label="filter"
	                        inputValue={{kfilter}}>
	            </grade-input>
	            
	            <grade-button toolbar icon="refresh" label="refresh list" on-click="{{refresh}}"></grade-button>
	            <grade-button toolbar icon="add" label="add query" on-click={{addQuery}}></grade-button>
	   
	        <query-list main listitems="{{queries}}" kfilter="{{kfilter}}" on-remove-item={{removeItem}}  on-clone-item={{cloneItem}}></query-list>
	        
	      </grade-header-panel>
	      
	      <grade-header-panel side fit paneltitle="PROPERTIES">
    	      <grade-button toolbar icon="lock" nohover tooltip=left label="predefined query is locked" hidden?="{{ !queries.selected.model.predefined}}"></grade-button>
	          <grade-button toolbar icon="create" label="edit query" on-click="{{onEdit}}" hidden?="{{queries.selected.edit || queries.selected.model.predefined}}"></grade-button>
	          <grade-button toolbar icon="cancel" label="discard changes" on-click="{{onCancel}}" hidden?={{!queries.selected.edit}}></grade-button>
	          <grade-button toolbar icon="save" label="save changes" on-click="{{onSave}}" hidden?={{!queries.selected.edit}} disabled={{!queries.selected.valid}}></grade-button>
	          <grade-button toolbar icon="av:play-arrow" label="run query" on-click="{{onQueryPlayground}}" disabled={{!queries.selected.valid}}></grade-button>
	          <query-details main item="{{queries.selected}}" editable="{{queries.selected.edit}}" validator={{model.validator}} spaced></query-details> 
	      </grade-header-panel>
	
	  </grade-scaffold>

      <query-playground editableQuery="{{queries.selected}}" on-back="{{onBack}}" on-run="{{onRunQuery}}"></query-playground>
	  
	  </core-animated-pages>
	  
	  <grade-dialog opened={{removeDialogOpened}} header={{removedDialogHeader}}>
	   <div main>There is no going back here. Are you sure?</div>
	   <paper-button label="Abort" affirmative></paper-button>
     <paper-button label="Remove" affirmative autofocus on-click={{deleteSelectedQuery}}></paper-button>
	  </grade-dialog>
  
  </template>
  
  <script type="application/dart" src="queries.dart"></script> 
  
</polymer-element>
