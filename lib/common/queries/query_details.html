<link rel="import" href="../../../../packages/polymer/polymer.html">
<link rel="import" href="../../../../packages/core_elements/core_icon.html">
<link rel="import" href="../../../../packages/paper_elements/paper_item.html">

<link rel="import" href="../components/grade_input.html">
<link rel="import" href="../components/grade_dropdown_menu.html">
<link rel="import" href="../components/grade_item.html">
<link rel="import" href="../components/grade_fascia.html">
<link rel="import" href="../components/loading_panel.html">
<link rel="import" href="../components/grade_uri.html">
<link rel="import" href="../components/grade_button.html">

<link rel="import" href="queries.html">

<polymer-element name="query-details" layout vertical> 

  <template>
  
		<style>
		  
		  grade-input::shadow [multiline] {
		     max-height: 150px;
		  }
		  
		  [truncate] {
		    overflow: hidden;
		    text-overflow: ellipsis;
		  }
		        
        :host [graphs] { min-height:80px; margin-top:15px }
        :host [graphs] core-selector:not([notap]) grade-uri { cursor:pointer }
		  
		</style>
		
		<div hidden?="{{item==null}}">

	    <loading-panel loading="{{loading}}" message="saving the query">
	   
	      <div style="overflow-y: auto;">
	      
	        <grade-item icon=chevron-right>
	          
	          <grade-fascia truncate>
	                   
	            <grade-input fascia-title 
	                         disabled="{{ !editable }}" 
	                         multiline?="{{ isAreaField(K.name) }}"
	                         label="{{ K.name | suffix }} ?" 
	                         required?="{{ isRequiredField(K.name) }}"
	                         validators="{{ validatorsFor(K.name)}}"
	                         invalid="{{ item.fieldsInvalidity[K.name] }}"
	                         inputValue="{{ item.model.bean[K.name]  }}">
	            </grade-input>
	                   
	            <div fascia-subtitle><span>{{ K.name | start}}</span><span fg bolder>{{ K.name | suffix}}</span></div>
	          </grade-fascia>
	            
	        </grade-item>
	  
	        <template repeat="{{key in fields}}">
	      
	          <grade-item icon=chevron-right>
	          
	            <grade-fascia truncate>
	                     
								<grade-input fascia-title 
								             disabled="{{ !editable }}" 
								             multiline?="{{ isAreaField(key) }}"
								             label="{{ key | suffix }} ?" 
								             required?="{{ isRequiredField(key) }}"
								             validators="{{ validatorsFor(key)}}"
								             invalid="{{ item.fieldsInvalidity[key] }}"
								             inputValue="{{ item.model.bean[key]  }}">
								</grade-input>
	                     
	              <div fascia-subtitle><span>{{ key | start}}</span><span fg bolder>{{ key | suffix}}</span></div>
	            </grade-fascia>
	              
	          </grade-item>
		       
	        </template>  
	 
	        <grade-item icon=chevron-right>
	        
	                 <div layout vertical flex>
				
	          <grade-fascia>
				        
	            <grade-dropdown-menu fascia-title flex
	                 disabled="{{ !editable }}" 
	                 selected="{{ item.model.bean[K.target] }}"
				           label="{{ K.target | suffix }} ?" 
				           required?="{{ isRequiredField(K.target) }}"
				           invalid="{{ item.fieldsInvalidity[K.target] }}"
				           >
				        <template repeat="{{target in endpoints.synchedData}}">
				          <paper-item truncate label="{{target.model.name}}" dropitem="{{target.model.id}}"></paper-item>
                </template>
	            </grade-dropdown-menu>
	            <div fascia-subtitle truncate><span>{{ K.target | start }}</span><span fg bolder>{{ K.target | suffix}}</span></div>
				        
	          </grade-fascia>

           <!-- graphs -->
           <grade-fascia truncate>
              
              <div graphs horizontal layout flex fascia-title>
              
                 <div smaller wired rounded relative flex>
                     <loading-panel fit loading="{{target.loadingGraphs==true}}" message="loading the graphs" style="overflow-y:auto;">
                        <core-selector id="targetGraphs"  
                                       notap?="{{!editable}}" 
                                       selected="{{item.model.bean[K.graph]}}" 
                                       multi 
                                       valueattr="item" 
                                       selectedAttribute="fg">
                         <template repeat="{{graph in target.model.graphs}}">
                               <grade-uri smaller item={{graph}} value={{graph}}></grade-uri>
                         </template>
                      </core-selector>
                     </loading-panel>
                  </div>
                  
                  <grade-button disabled?={{!editable}} side icon=refresh label="refresh graphs" on-click={{refreshTargetGraphs}}></grade-button>
           
              </div>
                       
                
             <grade-uri fascia-subtitle value="{{K.graph}}"></grade-uri>
             
           </grade-fascia>   
          
          </div>
				    
	        </grade-item>
	
		      <grade-item icon=chevron-right>
		      
		        <grade-fascia truncate>
                  
              <div fascia-title>{{ parameters }}</div>
              <div fascia-subtitle><span>{{ K.parameters | start }}</span><span fg bolder>{{ K.parameters | suffix}}</span></div>
                  
            </grade-fascia>

        </grade-item>
		   
		   
		      <grade-item icon=chevron-right>
		       
						<grade-fascia truncate>
						
							<div fascia-title>{{ item.model.endpoint }}</div>
							<div fascia-subtitle><span>{{ K.endpoint | start }}</span><span fg bolder>{{ K.endpoint | suffix}}</span></div>
						     
						</grade-fascia>
		           
		      </grade-item>
	          
	      </div>
	    </loading-panel>
    </div>
		
  </template> 
</polymer-element>
