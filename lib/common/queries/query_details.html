<link rel="import" href="../../../../packages/polymer/polymer.html">
<link rel="import" href="../../../../packages/core_elements/core_icon.html">
<link rel="import" href="../../../../packages/paper_elements/paper_item.html">

<link rel="import" href="../components/grade_input.html">
<link rel="import" href="../components/grade_dropdown_menu.html">
<link rel="import" href="../components/grade_item.html">
<link rel="import" href="../components/grade_fascia.html">
<link rel="import" href="../components/loading_panel.html">

<link rel="import" href="queries.html">

<polymer-element name="query-details" layout vertical> 

  <template>
  
		<style>
		  
		  grade-input::shadow [multiline] {
		     max-height: 150px;
		  }
		  
		  [truncate] {
		    overflow: hidden;
		    text-overflow: ellipsis;
		  }
		  
		</style>
		
		<template if="{{item!=null}}">

	    <loading-panel loading="{{loading}}" message="saving the query">
	   
	      <div style="overflow-y: auto;">
	      
	        <grade-item icon=chevron-right>
	          
	          <grade-fascia truncate>
	                   
	            <grade-input fascia-title 
	                         disabled="{{ !editable }}" 
	                         multiline?="{{ isAreaField(K.name) }}"
	                         label="{{ K.name | suffix }} ?" 
	                         required?="{{ isRequiredField(K.name) }}"
	                         validators="{{ validatorsFor(K.name)}}"
	                         invalid="{{ item.fieldsInvalidity[K.name] }}"
	                         inputValue="{{ item.model.bean[K.name]  }}">
	            </grade-input>
	                   
	            <div fascia-subtitle><span>{{ K.name | start}}</span><span fg bolder>{{ K.name | suffix}}</span></div>
	          </grade-fascia>
	            
	        </grade-item>
	  
	        <template repeat="{{key in fields}}">
	      
	          <grade-item icon=chevron-right>
	          
	            <grade-fascia truncate>
	                     
								<grade-input fascia-title 
								             disabled="{{ !editable }}" 
								             multiline?="{{ isAreaField(key) }}"
								             label="{{ key | suffix }} ?" 
								             required?="{{ isRequiredField(key) }}"
								             validators="{{ validatorsFor(key)}}"
								             invalid="{{ item.fieldsInvalidity[key] }}"
								             inputValue="{{ item.model.bean[key]  }}">
								</grade-input>
	                     
	              <div fascia-subtitle><span>{{ key | start}}</span><span fg bolder>{{ key | suffix}}</span></div>
	            </grade-fascia>
	              
	          </grade-item>
		       
	        </template>  
	 
	        <grade-item icon=chevron-right>
				
	          <grade-fascia>
				        
	            <grade-dropdown-menu fascia-title flex
	                 disabled="{{ !editable }}" 
	                 selected="{{ item.model.bean[K.target] }}"
				           label="{{ K.target | suffix }} ?" 
				           required?="{{ isRequiredField(K.target) }}"
				           invalid="{{ item.fieldsInvalidity[K.target] }}"
				           >
				        <template repeat="{{target in endpoints.synchedData}}">
				          <paper-item truncate label="{{target.model.name}}" dropitem="{{target.model.id}}"></paper-item>
                </template>
	            </grade-dropdown-menu>
	            <div fascia-subtitle truncate><span>{{ K.target | start }}</span><span fg bolder>{{ K.target | suffix}}</span></div>
				        
	          </grade-fascia>
				    
	        </grade-item>
	
		      <grade-item icon=chevron-right>
		       
						<grade-fascia truncate>
						      
							<div fascia-title>{{ parameters }}</div>
						  <div fascia-subtitle><span>{{ K.parameters | start }}</span><span fg bolder>{{ K.parameters | suffix}}</span></div>
						      
						</grade-fascia>
		           
		      </grade-item>
		   
		   
		      <grade-item icon=chevron-right>
		       
						<grade-fascia truncate>
						
							<div fascia-title>{{ item.model.endpoint }}</div>
							<div fascia-subtitle><span>{{ K.endpoint | start }}</span><span fg bolder>{{ K.endpoint | suffix}}</span></div>
						     
						</grade-fascia>
		           
		      </grade-item>
	          
	      </div>
	    </loading-panel>
    </template>
		
  </template> 
</polymer-element>
